<!DOCTYPE html>
<html lang="es">
<head>
    <style>a { pointer-events: none }</style>
    <meta charset="UTF-8">
    <title>Mantenimiento - Grouvex Studios</title>
    <meta property="og:site_name" content="Grouvex Studios">
    <meta property="og:title" content=">Mantenimiento - Grouvex Studios">
    <meta property="og:description" content=">Mantenimiento de ¬©Grouvex Studios">
    <meta property="og:type" content="website">
    <meta property="og:image" href="img/GROUVEX.png">
    <meta property="og:url" content="https://grouvex.com/">
    <meta property="og:locale" content="es_ES">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="temas.css">
    <link rel="icon" href="img/GROUVEX.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="MobileOptimized" content="width">
    <meta name="author" content="Grouvex Studios">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="copyright" content="Grouvex Studios">
    <meta name="google-site-verification" content="54a46b8f7ec187ad80dd5a45fff8f43b">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Referrer-Policy" content="no-referrer">
    <meta name="keywords" content="Grouvex, M√∫sica, Grouvex Studios, Grouvex's Projects">
    <meta name="theme-color" content="#hexcode">
    <link rel="canonical" href="https://grouvex.com/">
    <link rel="shortlink" href="https://grouvex.com/">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="HandheldFriendly" content="true">
    <link rel="preconnect" href="https://example.com">
    <link rel="dns-prefetch" href="https://example.com">
    <!-- Scripts sin nonce -->
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-auth.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-database.js"></script>
    <script src="jquery-3.5.1.min.js"></script>
        <script> 
        document.addEventListener("DOMContentLoaded", function() { 
            $("#menuG").load("menuG.html"); 
            $("#menuE").load("menuE.html"); 
            $("#menuT").load("menuT.html");
            $("#menuU").load("menuU.html");
            $("#footer").load("footer.html"); 
            $("#news").load("news.html"); 
            $("#tosypp").load("tosypp.html");
        });
    </script>
    <script src="//www.youtube.com/player_api"></script><script src="https://www.youtube.com/iframe_api"></script>
    <script src="time.js"></script></script><script src="index.js"></script>
</head>
<body>
        <header>
            <a href="https://grouvex.github.io/"> <div class="img-container"></div></a>
            <span style="font-family: Times New Roman;color:white;box-shadow: 0 0 10px gold;width:100%">
                <span id="menuG"></span>
                <span id="menuT"></span>
                <span id="menuU"></span>
        </header>
<body>
 <!-- Anuncio -->
<main>
  <!-- Publicado por -->
<div class="tarjeta" style="display: flex;align-items: center; border-radius: 8px;  box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin: 5px;  padding: 5px;  height: 50px; width: 300px; padding-top: 10px;padding-bottom: 10px">
<img src="img/GROUVEX.png" alt="" style="border-radius: 50%; width: 40px;height: 40px;object-fit: cover; margin-right: 10px;"><div>
<h2 style="margin: 0 0 3px;font-size: 8px">Publicado por:</h2><h2 style="margin: 0 0 2px; padding: 3px;font-size: 11px"><span id="Grouvex-Studios"></span></h2>
<p style="color: white; font-size: 10px"><span id="ActualizadoDATE"></span></p><a href="mailto:grouvex.studio@grouvex.com" style="color:white"><footer style="font-size: 0.7em; color: white; font-size: 6px;padding:3px">grouvex.studio@grouvex.com</footer></a></div></div>
<script>const uTActualizado = 1745670077; actualizarFechas(uTActualizado, "ActualizadoDATE");</script> 
  <!-- T√≠tulo -->
<article>
 <h1>P√°gina web en mantenimiento Grouvex Studios</h1>
 <!--Texto -->
  <section id="Intro">
   <h2>Introducci√≥n</h2>
    <p>La pagina web estar√° en mantenimiento hasta que finalice el periodo de actualizaci√≥n o mantenimiento. Si eres un miembro del equipo, registrese para acceder a la p√°gina web.</p>
    <p>Estamos revisando que todas las funciones vayan correctamente, antes de que pueda usar la web. Para cualquier informaci√≥n sobre la web, puede contactar con <a href="mailto:oficina@grouvex.com">oficina@grouvex.com</a>.</p>
  </section>
 <hr>
<div id="news"></div>
 </main>
<details>
    <summary><h2>Autentificaci√≥n</h2></summary>
    <main>
        <h1>Autenticaci√≥n de Usuarios en Grouvex Studios</h1>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<div id="auth-container">
    <form id="authForm">
        <h2 id="formTitle">Inicio de Sesi√≥n</h2>
        <input type="email" id="authEmail" placeholder="Email" required>
        <input type="password" id="authPassword" placeholder="Password" required>
        <input type="text" id="authDisplayName" placeholder="Nombre de Usuario">
        <div class="button-container">
            <button type="submit" id="authButton" class="icon-button" title="Verificar Autenticaci√≥n">
                <img src="https://raw.githubusercontent.com/Grouvex/grouvex.github.io/refs/heads/main/img/verified.png" alt="Iniciar Sesi√≥n" width="15" height="15">
            </button>
            <button type="button" id="toggleButton" class="icon-button secondary" title="Cambia de Iniciar Sesi√≥n a Registrarse y viceversa" disabled>
                <i class="fas fa-sync-alt"></i> <!-- √çcono de cambio -->
            </button>
            <button id="google-login-btn" class="icon-button google" title="Iniciar Sesi√≥n/Registrarse con Google" disabled>
                <img src="https://img.icons8.com/?size=512&id=17949&format=png" alt="Google" width="15" height="15">
            </button>
            <button id="email-login-btn" class="icon-button email" title="Iniciar Sesi√≥n/Registrarse con Email" disabled>
                <img src="https://static.vecteezy.com/system/resources/previews/022/484/508/non_2x/google-mail-gmail-icon-logo-symbol-free-png.png" alt="Email" width="15" height="15">
            </button>
        </div>
    </form>
    <p>¬øOlvidaste tu contrase√±a? P√≥ngase en contacto con: <a href="mailto:administracion@grouvex.com?subject=Cambiar%20contrase√±a&body=Hola,%0A%0ASoy%20[Nombre de Usuario],%20mi%20correo%20asociado%20es%20[Correo del Usuario]%20y%20mi%20GSUserID%20es:%20[UID del Usuario]%0ASe%20me%20ha%20olvidado%20mi%20contrase√±a%20y%20me%20gustar√≠a%20cambiarla.%0A%0AGracias,%0A[Nombre de Usuario]" style="color:white">administracion@grouvex.com</a></p>
    <p>Al registrarte o iniciar sesi√≥n en Grouvex Studios, acepta los <a href="https://grouvex.github.io/tos">T√©rminos de Servicios</a> y <a href="https://grouvex.github.io/pp">Pol√≠ticas de Privacidad del mismo</a>.</p>
    <hr>
    <aside>
    <p>El registro/inicio de sesi√≥n de Google y Email se est√° reparando. Para registrase e iniciar sesi√≥n, deber√° usar otros metodos para registrase o iniciar sesi√≥n. Si tiene cualquier duda, pongase en <a href="https://grouvex.github.io/contacto">contacto</a></p>
    </aside>
</div>
        <div id="content" style="display: none;">
            <h2>Bienvenido</h2>
            <p>Este contenido es visible solo para usuarios autenticados.</p>
            <p>Si desea eliminar la cuenta, envie un correo a <a href="mailto:administracion@grouvex.com?subject=Solicitud%20de%20Eliminaci√≥n%20de%20la%20Cuenta%20de%20Grouvex%20Studios" style="color:white">administracion@grouvex.com</a>, indicando: Nombre de Usuario, Correo Electronico y el GSUserID.</p>
            <p>Bienvenid@, si necesita ayuda, puede ponerse en <a href="https://grouvex.github.io/contacto" style="color:white">contacto</a> con el equipo.</p>
            <hr>
            <p>Informaci√≥n de la cuenta</p>
    <div class="tarjetas">
        <div class="tarjeta">
    <img id="fotoPerfil" src="https://grouvex.com/img/GROUVEX.png" alt="Foto de perfil">
    <div>
      <h2><span class="usuario"></span></h2>
      <hr>
      <p style="font-size:6px;font-family: Arial, Helvetica, sans-serif;"><n><span id="userID"></span></n></p>
      <p><footer><span id="correoElectronico"></span></footer></p>
    </div></div></div>
    <p style="font-size:12px">El GSUserID (GS-XXXXXXXXXXXX) es √∫nico por cada usuario. Sirve para formularios o para comprobar la existencia y el estado del usuario. En caso de no aparecer tu nombre de usuario, deber√°s iniciar con Google.</p>
            <hr>
            <button id="resetPasswordBtn" disabled>Cambiar Contrase√±a</button><button id="logoutBtn">Cerrar Sesi√≥n</button>
            <hr>
            <button id="deleteBtn" disabled>Eliminar Cuenta</button>
        <!-- En tu perfil.html -->
<div class="profile-stats">
    <p>Seguidores: <span id="followersCount">0</span></p>
    <p>Siguiendo: <span id="followingCount">0</span></p>
    <button id="followButton" style="display: none;">Seguir</button>
</div>

<!-- En tu lista de usuarios -->
<div id="usersContainer" class="users-list"></div>
</div>
    </main>
</details>
 <!-- Footer -->
 <div id="footer"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getAuth, EmailAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile, signOut, deleteUser, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, sendPasswordResetEmail, sendEmailVerification, reauthenticateWithCredential } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
import { getDatabase, ref, set, remove, onValue, onDisconnect, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

// ============================================
// CONFIGURACI√ìN INICIAL
// ============================================

const firebaseConfig = {
  apiKey: "AIzaSyAgoQ_Px3hHVrevUsyct_FBeXWMDKXpPSw",
  authDomain: "grouvex-studios.firebaseapp.com",
  databaseURL: "https://grouvex-studios-default-rtdb.firebaseio.com",
  projectId: "grouvex-studios",
  storageBucket: "grouvex-studios.appspot.com",
  messagingSenderId: "1070842606062",
  appId: "1:1070842606062:web:5d887863048fd100b49eff",
  measurementId: "G-75BR8D2CR3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const database = getDatabase(app);

// ============================================
// CONSTANTES Y DATOS
// ============================================

const uidsOwner = ["qY57xpuDyFdSOBxSNiehbRbJ1p32"];
const uidsTeamAdmins = ["cQRgzlky1eNHjUh61GMPTTRnIZq2", "aO5Y2hQVl9Zn7KlElpgI7jqsFfc2"];
const uidsTeamMods = [];
const uidsTeamBugs = [];
const uidsTeam = [...uidsOwner, ...uidsTeamAdmins, ...uidsTeamMods, ...uidsTeamBugs];
const uidsArtistas = [...uidsOwner, ...uidsTeamAdmins, "bY7fMyURlggvZyXDL9dCjwZEmU62", "LTqeoFuZmqTSa4HiJkfNXbCHifa2"];
const uidsPremium = [...uidsOwner, ...uidsTeamAdmins];
const uidsPartner = [...uidsOwner, ...uidsTeamAdmins];
const uidsVPartner = [...uidsOwner, ...uidsTeamAdmins];

const usuarios = {
    "Grouvex Studios": {
        principales: ["verified-team", "owner", "vvadmin", "vdeveloper", "vbughunter","gsmember"],
        GSRecording: [],
        GSAnimation: [],
        GSDesign: []
    },
    "Grouvex Phoenix": {
        principales: ["verified-team", "vvadmin", "vdeveloper", "vbughunter", "verified"],
        GSRecording: ["owner-recording", "artista", "verified"],
        GSAnimation: ["verified"],
        GSDesign: ["dise√±ador", "verified"]
    },
    "Tarlight Etherall": {
        principales: ["verified-team", "admin", "artista"],
        GSRecording: ["vvadmin", "artista", "gsmember", "verified"],
        GSAnimation: [],
        GSDesign: ["owner-designs", "dise√±ador", "verified"]
    },
    "Maiki Dran": {
        principales: ["gsmember", "verified"],
        GSRecording: ["artista", "verified"],
        GSAnimation: [],
        GSDesign: []
    },
    "Clara Langa": {
        principales: ["gsmember", "verified"],
        GSRecording: ["artista", "verified"],
        GSAnimation: [],
        GSDesign: []
    },
    "Joshuatdepedro": {
        principales: ["verified"],
        GSRecording: ["artista"],
        GSAnimation: [],
        GSDesign: []
    }
};

// ============================================
// FUNCIONES DE BASE DE DATOS
// ============================================

async function followUser(currentUserId, targetUserId) {
    await set(ref(database, `followers/${targetUserId}/${currentUserId}`), true);
    await set(ref(database, `following/${currentUserId}/${targetUserId}`), true);
}

async function unfollowUser(currentUserId, targetUserId) {
    await remove(ref(database, `followers/${targetUserId}/${currentUserId}`));
    await remove(ref(database, `following/${currentUserId}/${targetUserId}`));
}

async function getFollowStats(userId) {
    const followers = await get(ref(database, `followers/${userId}`));
    const following = await get(ref(database, `following/${userId}`));
    return {
        followersCount: followers.exists() ? Object.keys(followers.val()).length : 0,
        followingCount: following.exists() ? Object.keys(following.val()).length : 0
    };
}

async function checkIfFollowing(currentUserId, targetUserId) {
    const snapshot = await get(ref(database, `following/${currentUserId}/${targetUserId}`));
    return snapshot.exists();
}

async function getUserData(userId) {
    const snapshot = await get(ref(database, `users/${userId}`));
    return { uid: userId, ...snapshot.val() };
}

function setupPresence(user) {
    const userStatusRef = ref(database, `status/${user.uid}`);
    set(userStatusRef, { online: true, lastChanged: Date.now() });
    onDisconnect(userStatusRef).update({ online: false });
}

async function eliminarDatosUsuario(userId) {
    try {
        await Promise.all([
            remove(ref(database, `users/${userId}`)),
            remove(ref(database, `followers/${userId}`)),
            remove(ref(database, `following/${userId}`)),
            remove(ref(database, `status/${userId}`))
        ]);
        console.log('Datos de usuario eliminados exitosamente');
    } catch (error) {
        console.error('Error al eliminar datos:', error);
        throw new Error('Error al limpiar datos de usuario: ' + error.message);
    }
}

// ============================================
// FUNCIONES DE AUTENTICACI√ìN
// ============================================

async function completeUserProfile(user, isGoogleUser = false) {
    if (isGoogleUser && user.displayName) return;

    const displayName = user.displayName || prompt("¬øC√≥mo quieres que te llamemos?");
    
    await updateProfile(user, {
        displayName: displayName || "Usuario",
        photoURL: user.photoURL || "https://grouvex.com/img/GROUVEX.png"
    });

    await set(ref(database, `users/${user.uid}`), {
        email: user.email,
        displayName: displayName || "Usuario",
        photoURL: user.photoURL || "https://grouvex.com/img/GROUVEX.png",
        lastLogin: Date.now(),
        provider: isGoogleUser ? "google" : "email",
        emailVerified: isGoogleUser ? true : user.emailVerified
    });

    if (!isGoogleUser && !user.emailVerified) {
        await sendEmailVerification(user);
        mostrarNotificacion('üìß Se envi√≥ un correo de verificaci√≥n. Por favor revisa tu bandeja.');
    }
}

function handleEmailAuth(email, password, isLogin) {
    const authFunction = isLogin ? signInWithEmailAndPassword : createUserWithEmailAndPassword;
    
    authFunction(auth, email, password)
        .then(async (userCredential) => {
            if (!isLogin) await completeUserProfile(userCredential.user);
            mostrarNotificacion(`‚úÖ ${isLogin ? 'Inicio de sesi√≥n exitoso' : 'Registro completado'}`);
            redirectUser();
        })
        .catch(error => {
            mostrarNotificacion(`‚ùå Error: ${error.message}`, true);
        });
}

function handleGoogleLogin() {
    const provider = new GoogleAuthProvider();
    provider.setCustomParameters({ prompt: 'select_account' });

    signInWithPopup(auth, provider)
        .then(async (result) => {
            await completeUserProfile(result.user, true);
            mostrarNotificacion('‚úÖ ¬°Bienvenido con Google!');
            redirectUser();
        })
        .catch(error => {
            mostrarNotificacion(`‚ùå Error Google: ${error.message}`, true);
        });
}

function reauthenticateUser(user, password) {
    if (!password) throw new Error('Se requiere contrase√±a para esta acci√≥n');
    const credential = EmailAuthProvider.credential(user.email, password);
    return reauthenticateWithCredential(user, credential);
}

// ============================================
// FUNCIONES DE INTERFAZ DE USUARIO
// ============================================

function mostrarNotificacion(mensaje, esError = false) {
    const notificacion = document.createElement("div");
    notificacion.className = `notificacion ${esError ? 'error' : 'exito'}`;
    notificacion.innerHTML = `<p>${mensaje}</p><div class="progress-bar"></div>`;
    notificacion.style = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px;
        background: ${esError ? '#ff4444' : '#4CAF50'};
        color: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        z-index: 1000;
        max-width: 90%;
        width: 300px;
        text-align: center;
        font-size: 14px;
    `;
    document.body.appendChild(notificacion);
    setTimeout(() => notificacion.remove(), 8000);
}

function mostrarNotificacionRegistro() {
    const notificacion = document.createElement("div");
    notificacion.style = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px;
        background: #4CAF50;
        color: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        z-index: 1000;
        max-width: 90%;
        width: 300px;
        text-align: center;
        font-size: 14px;
    `;
    notificacion.innerHTML = `
        <p>üéÅ ¬°Reg√≠strate Gratis para acceder a contenido exclusivo!</p>
        <div style="margin-top: 10px; display: flex; justify-content: center; gap: 10px;">
            <a href="https://grouvex.github.io/login" style="color: white; text-decoration: underline;">Registrarme</a>
            <button onclick="this.parentElement.parentElement.remove()" 
                    style="background: none; border: none; color: white; cursor: pointer;">
                Cerrar
            </button>
        </div>
    `;
    document.body.appendChild(notificacion);
    setTimeout(() => notificacion.remove(), 8000);
}

function mostrarnewsAdv() {
    const newsAdv = document.createElement("div");
    if (window.innerWidth < 768) {
        newsAdv.style = `
            position: fixed;
            bottom: 3px;
            left: 1px;
            padding: 1px;
            background: rgb(5 59 219);
            color: white;
            border-radius: 9px;
            box-shadow: 2px 2px 2px gold;
            z-index: 1;
            width: 99%;
            max-height: 90px;
            overflow-y: auto;
            text-align: center;
            font-size: 12px;
        `;
    } else {
        newsAdv.style = `
            position: fixed;
            top: 3px;
            left: 1px;
            padding: 1px;
            background: rgb(5 59 219);
            color: white;
            border-radius: 9px;
            box-shadow: 2px 2px 2px gold;
            z-index: 1;
            width: 28%;
            max-height: 180px;
            overflow-y: auto;
            text-align: center;
            font-size: 12px;
        `;
    }
    newsAdv.innerHTML = `
        <h1 style="color: black"><span class="insignia owner-recording"></span> | Modifiac√≥n de Tiempos</h1>
        <div style="margin-top: 10px; display: flex; justify-content: center; gap: 10px;flex-wrap: wrap;flex-direction: column;align-content: center;">
        <p>El Equipo de Grouvex Studios Recording est√° satudado actualmente, por tanto, durante un periodo, la entrega del proyecto para lanzarlo, deber√° ser <n>6 semanas antes de la fecha de venta</n> que indique el artista.</p>
        <p>Entra en vigor el <n>2 de Marzo de 2025</n></p>
        <p>Esto modifica por tanto, la secci√≥n de <n>Obligaciones del Artista > Entrega de Material</n> <a href="https://grouvex.com/grouvex-studios-recording#Entrega_de_Material" style="color: white; text-decoration: underline;">GSRecording > Entrega de Material</a></p>
        <button onclick="this.parentElement.parentElement.remove()" style="background: none; color: red; cursor: pointer;">Cerrar</button>
        </div>
    `;
    document.body.appendChild(newsAdv);
}

function mostrarUsuarioYInsignias(nombreUsuario, elements) {
    elements.forEach(element => {
        // Mostrar nombre de usuario
        const spanNombre = document.createElement("span");
        spanNombre.textContent = nombreUsuario;
        element.appendChild(spanNombre);

        // Mostrar insignias principales
        const divPrincipales = document.createElement("div");
        usuarios[nombreUsuario].principales.forEach(insignia => {
            if (insignia) {
                const spanInsignia = document.createElement("span");
                spanInsignia.classList.add("insignia", insignia);
                divPrincipales.appendChild(spanInsignia);
            }
        });
        element.appendChild(divPrincipales);

        function crearDetallesInsignias(titulo, categoria) {
            if (usuarios[nombreUsuario][categoria]?.length > 0 && usuarios[nombreUsuario][categoria][0] !== "") {
                const details = document.createElement("details");
                const summary = document.createElement("summary");
                summary.textContent = titulo;
                summary.style.fontSize = "10px";

                details.appendChild(summary);
                const divInsignias = document.createElement("div");
                usuarios[nombreUsuario][categoria].forEach(insignia => {
                    if (insignia) {
                        const spanInsignia = document.createElement("span");
                        spanInsignia.classList.add("insignia", insignia);
                        divInsignias.appendChild(spanInsignia);
                    }
                });
                details.appendChild(divInsignias);
                return details;
            }
            return null;
        }

        const gsRecordingDetails = crearDetallesInsignias("GSRecording", "GSRecording");
        if (gsRecordingDetails) element.appendChild(gsRecordingDetails);

        const gsAnimationDetails = crearDetallesInsignias("GSAnimation", "GSAnimation");
        if (gsAnimationDetails) element.appendChild(gsAnimationDetails);

        const gsDesignDetails = crearDetallesInsignias("GSDesign", "GSDesign");
        if (gsDesignDetails) element.appendChild(gsDesignDetails);
    });
}

// ============================================
// FUNCIONES DE GESTI√ìN DE CUENTA
// ============================================

async function verificarCorreoUsuario(user) {
    return sendEmailVerification(user).then(() => {
        alert('Por favor, verifica tu correo electr√≥nico. Tienes 5 minutos para verificarlo.');

        return new Promise((resolve, reject) => {
            const checkVerificationInterval = setInterval(() => {
                user.reload().then(() => {
                    if (user.emailVerified) {
                        clearInterval(checkVerificationInterval);
                        clearTimeout(deleteAccountTimeout);
                        alert('Correo verificado con √©xito.');
                        resolve();
                    }
                }).catch((error) => {
                    console.error('Error al recargar el estado del usuario:', error.message);
                    reject(error);
                });
            }, 1000);

            const deleteAccountTimeout = setTimeout(() => {
                clearInterval(checkVerificationInterval);
                alert('Tiempo de verificaci√≥n agotado. No se pudo verificar el correo en el tiempo dado.');
                reject(new Error('Tiempo de verificaci√≥n agotado.'));
            }, 5 * 60 * 1000);
        });
    }).catch((error) => {
        console.error("Error al enviar correo de verificaci√≥n:", error.message);
        alert('Error al enviar correo de verificaci√≥n: ' + error.message);
        throw error;
    });
}

async function handleAccountDeletion() {
    const user = auth.currentUser;
    if (!user) {
        mostrarNotificacion('‚ùå Debes iniciar sesi√≥n para realizar esta acci√≥n', true);
        window.location.href = '/login';
        return;
    }

    const confirmation = confirm(`¬øEst√°s SEGURO que quieres eliminar tu cuenta de forma permanente?\n\nEsta acci√≥n:\n‚úÖ Eliminar√° todos tus datos\n‚úÖ Borrar√° tu historial\n‚úÖ Quitar√° tus permisos\nüö´ NO podr√° deshacerse\n\nEscribe "ELIMINAR" para confirmar.`);

    if (!confirmation) {
        mostrarNotificacion('‚úÖ Cancelaste la eliminaci√≥n de la cuenta');
        return;
    }

    const userInput = prompt('Escribe "ELIMINAR" para confirmar la eliminaci√≥n permanente:');
    if (userInput !== 'ELIMINAR') {
        mostrarNotificacion('‚ùå Confirmaci√≥n incorrecta. Eliminaci√≥n cancelada', true);
        return;
    }

    try {
        const password = prompt('Por seguridad, introduce tu contrase√±a para confirmar:');
        if (!password) {
            mostrarNotificacion('‚ùå Se requiere contrase√±a para esta acci√≥n', true);
            return;
        }

        const credential = EmailAuthProvider.credential(user.email, password);
        await reauthenticateWithCredential(user, credential);
        await eliminarDatosUsuario(user.uid);
        await deleteUser(user);
        
        mostrarNotificacion('üî• Cuenta eliminada permanentemente. ¬°Hasta pronto!');
        setTimeout(() => window.location.href = '/', 3000);
    } catch (error) {
        manejarErroresEliminacion(error);
    }
}

function manejarErroresEliminacion(error) {
    console.error('Error en eliminaci√≥n:', error);
    const mensajesError = {
        'auth/requires-recent-login': 'Debes volver a iniciar sesi√≥n para realizar esta acci√≥n. Redirigiendo...',
        'auth/wrong-password': 'Contrase√±a incorrecta. Intenta nuevamente.',
        'auth/network-request-failed': 'Error de red. Verifica tu conexi√≥n a internet.',
        'auth/too-many-requests': 'Demasiados intentos. Intenta m√°s tarde.',
        'default': 'Error cr√≠tico: ' + error.message
    };

    const mensaje = mensajesError[error.code] || mensajesError['default'];
    mostrarNotificacion(`‚ùå ${mensaje}`, true);
    
    if (error.code === 'auth/requires-recent-login') {
        setTimeout(() => window.location.href = '/login', 3000);
    }
}

// ============================================
// FUNCIONES DE CONTROL DE ACCESO
// ============================================

function verificarAcceso() {
    onAuthStateChanged(auth, (user) => {
        const mantenimientoActivo = true;
        const paginaMantenimiento = "mantenimiento";
        const paginaActual = window.location.pathname.split("/").pop();

        if (mantenimientoActivo) {
            if (paginaActual !== paginaMantenimiento && !(user && uidsTeam.includes(user.uid))) {
                alert(`üöß La P√°gina est√° en mantenimiento, se te refirigir√° a ${paginaMantenimiento}.`);
                setTimeout(() => { window.location.href = `https://grouvex.github.io/${paginaMantenimiento}`; }, 3000);
                return;
            }
        } else if (paginaActual === paginaMantenimiento) {
            window.location.href = "https://grouvex.github.io";
            return;
        }

        const permisos = {
            "grouvex-studios-recording": uidsArtistas,
            "grouvex-studios-animation": uidsArtistas,
            "team": uidsTeam,
            "planeta": [...uidsPartner, ...uidsVPartner],
            "pacman": [...uidsPremium, ...uidsPartner, ...uidsVPartner]
        };

        const nombresEquipos = {
            "grouvex-studios-recording": "Artista",
            "grouvex-studios-animation": "Artista",
            "team": "Team",
            "planeta": "Partner o VPartner",
            "pacman": "Premium, Partner o VPartner"
        };

        if (permisos[paginaActual]) {
            if (!user) {
                alert(`üîí Necesitas estar registrado y ser ${nombresEquipos[paginaActual]}`);
                mostrarNotificacion(`üîí Necesitas estar registrado y ser ${nombresEquipos[paginaActual]}`);
                setTimeout(() => { window.location.href = "https://grouvex.github.io/login" }, 5000);
                return;
            }

            if (!permisos[paginaActual].includes(user.uid)) {
                const equipoRequerido = nombresEquipos[paginaActual];
                alert(`‚õî Requieres ser ${equipoRequerido}. Redirigiendo a Equipo ‚Üí Insignias...`);
                mostrarNotificacion(`‚õî Requieres ser ${equipoRequerido}. Redirigiendo a Equipo ‚Üí Insignias...`);
                setTimeout(() => {
                    window.location.href = "https://grouvex.github.io/equipo#insignias";
                }, 5000);
                return;
            }
        } else if (!user) {
            mostrarNotificacionRegistro();
        }
    });
}

// ============================================
// FUNCIONES DE NAVEGACI√ìN
// ============================================

function redirectUser() {
    const user = auth.currentUser;
    if (!user) return;
    
    const defaultPath = "https://grouvex.github.io";
    const lastPath = defaultPath;
    verificarAcceso();
    setTimeout(() => { window.location.href = lastPath; }, 1000);
}

// ============================================
// INICIALIZACI√ìN
// ============================================

function inicializarFormularioDeAutenticacion() {
    const authForm = document.getElementById('authForm');
    const formTitle = document.getElementById('formTitle');
    const toggleButton = document.getElementById('toggleButton');
    let isLogin = true;

    toggleButton.addEventListener('click', () => {
        isLogin = !isLogin;
        formTitle.textContent = isLogin ? 'Inicio de Sesi√≥n' : 'Registro';
    });

    authForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;
        handleEmailAuth(email, password, isLogin);
    });

    document.getElementById('google-login-btn').addEventListener('click', handleGoogleLogin);
}

document.addEventListener('DOMContentLoaded', () => {
    
    // Configurar botones
    document.getElementById('logoutBtn')?.addEventListener('click', () => signOut(auth));
    document.getElementById('deleteBtn')?.addEventListener('click', (e) => {
        e.preventDefault();
        handleAccountDeletion();
    });
    document.getElementById('resetPasswordBtn')?.addEventListener('click', () => {
        const email = prompt('Introduce tu correo electr√≥nico para restablecer la contrase√±a:');
        if (email) {
            sendPasswordResetEmail(auth, email)
                .then(() => alert('Correo para restablecer la contrase√±a enviado.'))
                .catch((error) => alert('Error al enviar el correo de restablecimiento: ' + error.message));
        }
    });

    // Mostrar noticias
    if (true) mostrarnewsAdv();

    // Verificar acceso
    const paginaActual = window.location.pathname.split("/").pop();
    if (paginaActual !== 'login') verificarAcceso();

    // Cargar insignias
    Object.keys(usuarios).forEach(usuario => {
        const elements = document.querySelectorAll(`.${usuario.replace(/\s+/g, '-')}`);
        if (elements.length > 0) mostrarUsuarioYInsignias(usuario, elements);
    });
});

// Observador de autenticaci√≥n principal
onAuthStateChanged(auth, async (user) => {
    if (user) {
        setupPresence(user);
        console.log("Usuario autenticado:", user.email);

        const urlParams = new URLSearchParams(window.location.search);
        const viewedUserId = urlParams.get('userId');
        const isViewingOwnProfile = !viewedUserId || viewedUserId === user.uid;
        const targetUserId = isViewingOwnProfile ? user.uid : viewedUserId;
        const targetUser = isViewingOwnProfile ? user : await getUserData(targetUserId);
        const nombreUsuario = targetUser.displayName || "Usuario";
        const usuarioElement = document.querySelector('.usuario');

        // Actualizar UI
        const updateProfileUI = () => {
            document.getElementById('correoElectronico').textContent = targetUser.email || 'Correo no definido';
            usuarioElement.className = nombreUsuario.replace(/\s+/g, '-');
            document.getElementById('userID').textContent = `GS-${targetUser.uid}`;
            document.getElementById('fotoPerfil').src = targetUser.photoURL || 'https://grouvex.com/img/GROUVEX.png';
            mostrarUsuarioYInsignias(nombreUsuario, [usuarioElement]);
        };

        // Manejar seguimiento
        const updateFollowUI = async () => {
            const followButton = document.getElementById('followButton');
            const followersCount = document.getElementById('followersCount');
            const followingCount = document.getElementById('followingCount');

            const stats = await getFollowStats(targetUser.uid);
            followersCount.textContent = stats.followersCount;
            followingCount.textContent = stats.followingCount;

            if (!isViewingOwnProfile) {
                const isFollowing = await checkIfFollowing(user.uid, targetUser.uid);
                followButton.style.display = 'block';
                followButton.textContent = isFollowing ? 'Dejar de seguir' : 'Seguir';
                followButton.onclick = async () => {
                    try {
                        if (isFollowing) await unfollowUser(user.uid, targetUser.uid);
                        else await followUser(user.uid, targetUser.uid);
                        updateFollowUI();
                    } catch (error) {
                        mostrarNotificacion(`Error: ${error.message}`, true);
                    }
                };
            } else {
                followButton.style.display = 'none';
            }
        };

        // Mostrar contenido
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('content').style.display = 'block';
        updateProfileUI();
        await updateFollowUI();

    } else {
        console.log("Usuario no autenticado");
        document.getElementById('auth-container').style.display = 'block';
        document.getElementById('content').style.display = 'none';
        if (window.location.pathname.includes('login')) {
            inicializarFormularioDeAutenticacion();
        }
    }
});
</script>
</body>
</html>
