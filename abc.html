<!DOCTYPE html>
<html lang="es">
<head>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
    <script src="jquery-3.5.1.min.js"></script>
    <script> 
        $(function(){
            $("#menu").load("menu.html"); 
        });
        $(function(){
            $("#footer").load("footer.html"); 
        });
        $(function(){
            $("#news").load("news.html"); 
        });
    </script>
</head>
<body>
<main>
    <h1>Comentarios de Usuarios</h1>
    <nav>
        <a onclick="showSection('reportes')" style="pointer-events: none">Reportes en la Web</a>
        <a onclick="showSection('sugerencias')">Sugerencias</a>
        <a onclick="showSection('comentarios')">Comentarios</a>
        <a onclick="showSection('deseos2024')">Deseos 2024</a>
        <a onclick="showSection('configuracion')">Configuraci칩n</a>
    </nav>

    <section id="reportes" class="active">
        <div class="comment-form">
            <h2>Reportes a la p치gina web</h2>
            <input type="text" id="nombreInputReporte" placeholder="Tu nombre (opcional)..."><br>
            <textarea id="reporteInput" rows="4" placeholder="Escribe tu reporte aqu칤..."></textarea><br>
            <button onclick="addComment('reportes', 'nombreInputReporte')">Enviar</button>
            <button class="orden-button" onclick="ordenarComentarios('reportes')">Ordenar</button>
        </div>
        <div class="comments-section" id="reportesComments">
            <h3>Reportes:</h3>
        </div>
    </section>

    <section id="sugerencias">
        <div class="comment-form">
            <h2>Sugerencias</h2>
            <input type="text" id="nombreInputSugerencia" placeholder="Tu nombre (opcional)..."><br>
            <textarea id="sugerenciaInput" rows="4" placeholder="Escribe tu sugerencia aqu칤..."></textarea><br>
            <button onclick="addComment('sugerencias', 'nombreInputSugerencia')">Enviar</button>
            <button class="orden-button" onclick="ordenarComentarios('sugerencias')">Ordenar</button>
        </div>
        <div class="comments-section" id="sugerenciasComments">
            <h3>Sugerencias:</h3>
        </div>
    </section>
    
    <section id="comentarios">
        <div class="comment-form">
            <h2>Comentarios</h2>
            <input type="text" id="nombreInputComentario" placeholder="Tu nombre (opcional)..."><br>
            <textarea id="comentarioInput" rows="4" placeholder="Escribe tu comentario aqu칤..."></textarea><br>
            <button onclick="addComment('comentarios', 'nombreInputComentario')">Enviar</button>
            <button class="orden-button" onclick="ordenarComentarios('comentarios')">Ordenar</button>
        </div>
        <div class="comments-section" id="comentariosComments">
            <h3>Comentarios:</h3>
        </div>
    </section>

    <section id="deseos2024">
        <div class="comment-form">
            <h2>Deseos 2024</h2>
            <input type="text" id="nombreInputDeseos" placeholder="Tu nombre (opcional)..."><br>
            <textarea id="deseoInput" rows="4" placeholder="Escribe tu deseo aqu칤..."></textarea><br>
            <button onclick="addComment('deseos2024', 'nombreInputDeseos')">Enviar</button>
            <button class="orden-button" onclick="ordenarComentarios('deseos2024')">Ordenar</button>
        </div>
        <div class="comments-section" id="deseos2024Comments">
            <h3>Deseos 2024:</h3>
        </div>
    </section>

    <section id="configuracion">
        <div class="config-section">
            <h2>Configuraci칩n</h2>
            <button onclick="requestPasswordChange()">Cambiar Contrase침a</button>
        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyAgoQ_Px3hHVrevUsyct_FBeXWMDKXpPSw",
            authDomain: "grouvex-studios.firebaseapp.com",
            projectId: "grouvex-studios",
            storageBucket: "grouvex-studios.firebasestorage.app",
            messagingSenderId: "1070842606062",
            appId: "1:1070842606062:web:5d887863048fd100b49eff",
            measurementId: "G-75BR8D2CR3"
        };
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        document.addEventListener('DOMContentLoaded', () => {
            cargarComentarios('reportes');
            cargarComentarios('sugerencias');
            cargarComentarios('comentarios');
            cargarComentarios('deseos2024');
        });

        function cargarComentarios(section) {
            const commentSection = document.getElementById(`${section}Comments`);
            database.ref(`comments/${section}`).once('value', (snapshot) => {
                const comments = snapshot.val();
                if (comments) {
                    commentSection.innerHTML = ''; // Limpiar la secci칩n antes de a침adir comentarios
                    for (let id in comments) {
                        const commentPara = document.createElement('p');
                        commentPara.innerHTML = `<strong>${comments[id].timestamp} - ${comments[id].name}:</strong> ${comments[id].comment} <span class="delete-button" onclick="requestDeleteComment(this)">游딈</span>`;
                        commentPara.dataset.timestamp = comments[id].timestamp;
                        commentPara.dataset.key = id; // A침adir clave para eliminar
                        commentSection.appendChild(commentPara);
                    }
                }
            });
        }

        function requestDeleteComment(element) {
            const password = prompt("Ingrese la contrase침a de administrador para eliminar este comentario:");
            if (md5(password) === localStorage.getItem('adminHash')) {
                const commentKey = element.parentElement.dataset.key; // Obtener la clave del comentario
                const sectionId = element.parentElement.parentElement.id.replace('Comments', '');
                element.parentElement.remove();
                eliminarComentario(sectionId, commentKey);
            } else {
                alert("Contrase침a incorrecta.");
            }
        }

        function eliminarComentario(section, commentKey) {
            database.ref(`comments/${section}/${commentKey}`).remove()
                .then(() => {
                    alert("Comentario eliminado correctamente.");
                })
                .catch(error => {
                    alert("Error al eliminar el comentario: " + error.message);
                });
        }
    </script>
</main>
 <!-- Footer -->
 <div id="footer"></div>
</body>
</html>
