<!DOCTYPE html>
<html lang="es">
<head>
    <style>
        a { pointer-events: none }
        .notificacion {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            background: #4CAF50;
            color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 90%;
            width: 300px;
            text-align: center;
            font-size: 14px;
        }
        .notificacion.error {
            background: #ff4444;
        }
        .progress-bar {
            height: 4px;
            background: rgba(255,255,255,0.5);
            width: 100%;
            margin-top: 10px;
            animation: progress 8s linear forwards;
        }
        @keyframes progress {
            from { width: 100%; }
            to { width: 0%; }
        }
        #auth-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
        }
        #authForm input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: rgba(255,255,255,0.9);
        }
        .button-container {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .icon-button {
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #4285F4;
            color: white;
            flex: 1;
        }
        .icon-button.secondary {
            background: #5c5c5c;
        }
        .icon-button.google {
            background: #DB4437;
        }
        .icon-button.email {
            background: #BB001B;
        }
        .tarjeta {
            display: flex;
            align-items: center;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 5px;
            padding: 5px;
            height: 50px;
            width: 300px;
            padding-top: 10px;
            padding-bottom: 10px;
            background: rgba(0,0,0,0.5);
        }
    </style>
    <meta charset="UTF-8">
    <title>Mantenimiento - Grouvex Studios</title>
    <meta property="og:site_name" content="Grouvex Studios">
    <meta property="og:title" content="Mantenimiento - Grouvex Studios">
    <meta property="og:description" content="Mantenimiento de ©Grouvex Studios">
    <meta property="og:type" content="website">
    <meta property="og:image" href="img/GROUVEX.png">
    <meta property="og:url" content="https://grouvex.com/">
    <meta property="og:locale" content="es_ES">
    <link rel="icon" href="img/GROUVEX.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Grouvex Studios">
    <meta name="copyright" content="Grouvex Studios">
    <meta name="MobileOptimized" content="width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="54a46b8f7ec187ad80dd5a45fff8f43b">
     <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
     <meta http-equiv="Referrer-Policy" content="no-referrer">
     <meta name="keywords" content="Grouvex, Música, Grouvex Studios, Grouvex's Projects">
     <meta name="theme-color" content="#hexcode">
     <link rel="canonical" href="https://grouvex.com/">
     <link rel="shortlink" href="https://grouvex.com/">
     <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
     <meta name="HandheldFriendly" content="true">
     <link rel="preconnect" href="https://example.com">
     <link rel="dns-prefetch" href="https://example.com">
     <!-- Scripts sin nonce -->
     <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js"></script> 
     <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-auth.js"></script> 
     <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-database.js"></script>
     <script src="jquery-3.5.1.min.js"></script>
         <script> 
         document.addEventListener("DOMContentLoaded", function() { 
             $("#menuG").load("menuG.html"); 
             $("#menuE").load("menuE.html"); 
             $("#menuT").load("menuT.html");
             $("#menuU").load("menuU.html");
             $("#footer").load("footer.html"); 
             $("#news").load("news.html"); 
             $("#tosypp").load("tosypp.html");
         });
     </script>
     <script src="//www.youtube.com/player_api"></script><script src="https://www.youtube.com/iframe_api"></script>
     <script src="time.js"></script></script><script src="index.js"></script>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="temas.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>
<header>
     <a href="https://grouvex.github.io/"> <div class="img-container"></div></a>
     <span style="font-family: Times New Roman;color:white;box-shadow: 0 0 10px gold;width:100%">
         <span id="menuG"></span>
         <span id="menuT"></span>
         <span id="menuU"></span>
 </header>
    <main>
        <!-- Publicado por -->
        <div class="tarjeta">
            <img src="img/GROUVEX.png" alt="" style="border-radius: 50%; width: 40px;height: 40px;object-fit: cover; margin-right: 10px;">
            <div>
                <h2 style="margin: 0 0 3px;font-size: 8px">Publicado por:</h2>
                <h2 style="margin: 0 0 2px; padding: 3px;font-size: 11px">Grouvex Studios</h2>
                <p style="color: white; font-size: 10px"><span id="ActualizadoDATE"></span></p>
                <a href="mailto:grouvex.studio@grouvex.com" style="color:white">
                    <footer style="font-size: 0.7em; color: white; font-size: 6px;padding:3px">grouvex.studio@grouvex.com</footer>
                </a>
            </div>
        </div>
<script>const uTActualizado = 1745670077; actualizarFechas(uTActualizado, "ActualizadoDATE");</script> 
        <!-- Título -->
        <article>
            <h1>Página web en mantenimiento Grouvex Studios</h1>
            <!--Texto -->
            <section id="Intro">
                <h2>Introducción</h2>
                <p>La pagina web estará en mantenimiento hasta que finalice el periodo de actualización o mantenimiento. Si eres un miembro del equipo, registrese para acceder a la página web.</p>
                <p>Estamos revisando que todas las funciones vayan correctamente, antes de que pueda usar la web. Para cualquier información sobre la web, puede contactar con <a href="mailto:oficina@grouvex.com">oficina@grouvex.com</a>.</p>
            </section>
            <hr>
        </article>
    <details>
        <summary><h2>Autentificación</h2></summary>
        <main>
            <h1>Autenticación de Usuarios en Grouvex Studios</h1>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
            
            <div id="auth-container">
                <form id="authForm">
                    <h2 id="formTitle">Inicio de Sesión</h2>
                    <input type="email" id="authEmail" placeholder="Email" required>
                    <input type="password" id="authPassword" placeholder="Password" required>
                    <input type="text" id="authDisplayName" placeholder="Nombre de Usuario" style="display:none">
                    <div class="button-container">
                        <button type="submit" id="authButton" class="icon-button" title="Verificar Autenticación">
                            <img src="https://raw.githubusercontent.com/Grouvex/grouvex.github.io/main/img/verified.png" alt="Iniciar Sesión" width="15" height="15">
                        </button>
                        <button type="button" id="toggleButton" class="icon-button secondary" title="Cambia de Iniciar Sesión a Registrarse y viceversa" disabled>
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button id="google-login-btn" class="icon-button google" title="Iniciar Sesión/Registrarse con Google">
                            <img src="https://img.icons8.com/?size=512&id=17949&format=png" alt="Google" width="15" height="15">
                        </button>
                    </div>
                </form>
                <p>¿Olvidaste tu contraseña? Póngase en contacto con: <a href="mailto:administracion@grouvex.com?subject=Cambiar%20contraseña&body=Hola,%0A%0ASoy%20[Nombre de Usuario],%20mi%20correo%20asociado%20es%20[Correo del Usuario]%20y%20mi%20GSUserID%20es:%20[UID del Usuario]%0ASe%20me%20ha%20olvidado%20mi%20contraseña%20y%20me%20gustaría%20cambiarla.%0A%0AGracias,%0A[Nombre de Usuario]" style="color:white">administracion@grouvex.com</a></p>
                <p>Al registrarte o iniciar sesión en Grouvex Studios, acepta los <a href="https://grouvex.github.io/tos" style="color:white">Términos de Servicios</a> y <a href="https://grouvex.github.io/pp" style="color:white">Políticas de Privacidad del mismo</a>.</p>
            </div>

            <div id="content" style="display: none;">
                <h2>Bienvenido</h2>
                <p>Este contenido es visible solo para usuarios autenticados.</p>
                <p>Si desea eliminar la cuenta, envie un correo a <a href="mailto:administracion@grouvex.com?subject=Solicitud%20de%20Eliminación%20de%20la%20Cuenta%20de%20Grouvex%20Studios" style="color:white">administracion@grouvex.com</a>, indicando: Nombre de Usuario, Correo Electronico y el GSUserID.</p>
                <p>Bienvenid@, si necesita ayuda, puede ponerse en <a href="https://grouvex.github.io/contacto" style="color:white">contacto</a> con el equipo.</p>
                <hr>
                <p>Información de la cuenta</p>
                <div class="tarjeta">
                    <img id="fotoPerfil" src="https://grouvex.com/img/GROUVEX.png" alt="Foto de perfil" style="border-radius: 50%; width: 40px; height: 40px; margin-right: 10px;">
                    <div>
                        <h2><span class="usuario"></span></h2>
                        <hr>
                        <p style="font-size:6px;font-family: Arial, Helvetica, sans-serif;"><n><span id="userID"></span></n></p>
                        <p><footer><span id="correoElectronico"></span></footer></p>
                    </div>
                </div>
                <p style="font-size:12px">El GSUserID (GS-XXXXXXXXXXXX) es único por cada usuario. Sirve para formularios o para comprobar la existencia y el estado del usuario. En caso de no aparecer tu nombre de usuario, deberás iniciar con Google.</p>
                <hr>
                <button id="resetPasswordBtn">Cambiar Contraseña</button>
                <button id="logoutBtn">Cerrar Sesión</button>
                <hr>
                <button id="deleteBtn">Eliminar Cuenta</button>
            </div>
        </main>
    </details>
    </main>
    <div id="footer"></div>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAgoQ_Px3hHVrevUsyct_FBeXWMDKXpPSw",
            authDomain: "grouvex-studios.firebaseapp.com",
            databaseURL: "https://grouvex-studios-default-rtdb.firebaseio.com",
            projectId: "grouvex-studios",
            storageBucket: "grouvex-studios.appspot.com",
            messagingSenderId: "1070842606062",
            appId: "1:1070842606062:web:5d887863048fd100b49eff",
            measurementId: "G-75BR8D2CR3"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // IDs de usuarios con permisos especiales
        const uidsOwner = ["qY57xpuDyFdSOBxSNiehbRbJ1p32"];
        const uidsTeamAdmins = ["cQRgzlky1eNHjUh61GMPTTRnIZq2", "aO5Y2hQVl9Zn7KlElpgI7jqsFfc2"];
        const uidsTeamMods = [];
        const uidsTeamBugs = [];
        const uidsTeam = [...uidsOwner, ...uidsTeamAdmins, ...uidsTeamMods, ...uidsTeamBugs];

        // Función para mostrar notificaciones
        function mostrarNotificacion(mensaje, esError = false) {
            const notificacion = document.createElement("div");
            notificacion.className = `notificacion ${esError ? 'error' : ''}`;
            notificacion.innerHTML = `<p>${mensaje}</p><div class="progress-bar"></div>`;
            document.body.appendChild(notificacion);
            setTimeout(() => notificacion.remove(), 5000);
        }

        // Función para traducir errores de Firebase
        function traducirError(error) {
            const errores = {
                'auth/invalid-email': 'Correo electrónico inválido',
                'auth/user-disabled': 'Cuenta deshabilitada',
                'auth/user-not-found': 'Usuario no encontrado',
                'auth/wrong-password': 'Contraseña incorrecta',
                'auth/email-already-in-use': 'El correo ya está en uso',
                'auth/operation-not-allowed': 'Operación no permitida',
                'auth/weak-password': 'Contraseña débil (mínimo 6 caracteres)',
                'auth/requires-recent-login': 'Debes volver a iniciar sesión para esta acción'
            };
            return errores[error.code] || error.message;
        }

        // Función para manejar autenticación con email/contraseña
        async function handleEmailAuth(email, password, isLogin) {
            try {
                let userCredential;
                
                if (isLogin) {
                    userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                    mostrarNotificacion('✅ Inicio de sesión exitoso');
                } else {
                    userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                    const displayName = document.getElementById('authDisplayName').value;
                    
                    // Actualizar perfil del usuario
                    await userCredential.user.updateProfile({
                        displayName: displayName || "Usuario",
                        photoURL: "https://grouvex.com/img/GROUVEX.png"
                    });
                    
                    // Guardar información adicional en la base de datos
                    await database.ref('users/' + userCredential.user.uid).set({
                        email: userCredential.user.email,
                        displayName: displayName || "Usuario",
                        photoURL: "https://grouvex.com/img/GROUVEX.png",
                        lastLogin: Date.now(),
                        provider: "email"
                    });
                    
                    // Enviar correo de verificación
                    await userCredential.user.sendEmailVerification();
                    mostrarNotificacion('✅ Registro completado. Se ha enviado un correo de verificación.');
                }
                
                // Redirigir después de autenticación exitosa
                redirectUser();
            } catch (error) {
                mostrarNotificacion(`❌ ${traducirError(error)}`, true);
            }
        }

        // Función para manejar autenticación con Google
        async function handleGoogleLogin() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.setCustomParameters({ prompt: 'select_account' });
                
                const result = await firebase.auth().signInWithPopup(provider);
                
                // Guardar información del usuario en la base de datos
                await database.ref('users/' + result.user.uid).set({
                    email: result.user.email,
                    displayName: result.user.displayName,
                    photoURL: result.user.photoURL || "https://grouvex.com/img/GROUVEX.png",
                    lastLogin: Date.now(),
                    provider: "google"
                });
                
                mostrarNotificacion('✅ Inicio de sesión con Google exitoso');
                redirectUser();
            } catch (error) {
                mostrarNotificacion(`❌ ${traducirError(error)}`, true);
            }
        }

        // Función para redirigir al usuario después de autenticarse
        function redirectUser() {
            const user = auth.currentUser;
            if (!user) return;
            
            // Si el usuario es del equipo, redirigir a la última página o a la principal
            if (uidsTeam.includes(user.uid)) {
                const lastPath = localStorage.getItem('lastPath') || "https://grouvex.github.io";
                window.location.href = lastPath;
            } else {
                // Usuarios normales son redirigidos a la página principal
                window.location.href = "https://grouvex.github.io";
            }
        }

        // Función para inicializar el formulario de autenticación
        function inicializarFormularioDeAutenticacion() {
            const authForm = document.getElementById('authForm');
            const formTitle = document.getElementById('formTitle');
            const authButton = document.getElementById('authButton');
            const toggleButton = document.getElementById('toggleButton');
            const authDisplayName = document.getElementById('authDisplayName');
            let isLogin = true;

            // Cambiar entre login y registro
            function toggleAuthMode() {
                isLogin = !isLogin;
                formTitle.textContent = isLogin ? 'Inicio de Sesión' : 'Registro';
                authButton.innerHTML = isLogin ? 
                    '<img src="https://raw.githubusercontent.com/Grouvex/grouvex.github.io/main/img/verified.png" alt="Iniciar Sesión" width="15" height="15">' : 
                    '<img src="https://raw.githubusercontent.com/Grouvex/grouvex.github.io/main/img/add-user.png" alt="Registrarse" width="15" height="15">';
                authDisplayName.style.display = isLogin ? 'none' : 'block';
            }

            toggleButton.addEventListener('click', toggleAuthMode);
            toggleAuthMode(); // Inicializar en modo login

            // Manejar envío del formulario
            authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('authEmail').value;
                const password = document.getElementById('authPassword').value;
                
                if (!isLogin) {
                    const displayName = document.getElementById('authDisplayName').value;
                    if (!displayName) {
                        mostrarNotificacion('❌ Por favor, ingresa un nombre de usuario', true);
                        return;
                    }
                }
                
                handleEmailAuth(email, password, isLogin);
            });

            // Configurar botón de Google
            document.getElementById('google-login-btn').addEventListener('click', handleGoogleLogin);
        }

        // Función para actualizar la UI con la información del usuario
        function updateUserUI(user) {
            document.getElementById('correoElectronico').textContent = user.email;
            document.querySelector('.usuario').textContent = user.displayName || "Usuario";
            document.getElementById('userID').textContent = `GS-${user.uid}`;
            document.getElementById('fotoPerfil').src = user.photoURL || "https://grouvex.com/img/GROUVEX.png";
            
            // Mostrar contenido para usuarios autenticados
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        }

        // Configurar botones de la interfaz de usuario
        function setupUIButtons() {
            // Botón de cerrar sesión
            document.getElementById('logoutBtn')?.addEventListener('click', () => {
                auth.signOut().then(() => {
                    window.location.reload(); // Recargar la página después de cerrar sesión
                });
            });
            
            // Botón de cambiar contraseña
            document.getElementById('resetPasswordBtn')?.addEventListener('click', () => {
                const email = prompt('Introduce tu correo electrónico para restablecer la contraseña:');
                if (email) {
                    auth.sendPasswordResetEmail(email)
                        .then(() => mostrarNotificacion('✅ Correo para restablecer contraseña enviado'))
                        .catch(error => mostrarNotificacion(`❌ ${traducirError(error)}`, true));
                }
            });
            
            // Botón de eliminar cuenta
            document.getElementById('deleteBtn')?.addEventListener('click', async () => {
                const user = auth.currentUser;
                if (!user) return;
                
                const confirmation = confirm(`¿Estás SEGURO que quieres eliminar tu cuenta de forma permanente?\n\nEsta acción:\n✅ Eliminará todos tus datos\n✅ Borrará tu historial\n✅ Quitará tus permisos\n🚫 NO podrá deshacerse`);
                
                if (confirmation) {
                    try {
                        // Eliminar datos de la base de datos
                        await database.ref('users/' + user.uid).remove();
                        
                        // Eliminar usuario de autenticación
                        await user.delete();
                        
                        mostrarNotificacion('🔥 Cuenta eliminada permanentemente. ¡Hasta pronto!');
                        setTimeout(() => window.location.href = '/', 2000);
                    } catch (error) {
                        mostrarNotificacion(`❌ ${traducirError(error)}`, true);
                    }
                }
            });
        }

        // Observador de estado de autenticación
        auth.onAuthStateChanged(user => {
            if (user) {
                // Usuario autenticado
                updateUserUI(user);
                
                // Configurar presencia del usuario
                const userStatusRef = database.ref('status/' + user.uid);
                database.ref('.info/connected').on('value', (snapshot) => {
                    if (snapshot.val() === false) return;
                    
                    userStatusRef.onDisconnect().set({
                        online: false,
                        lastChanged: firebase.database.ServerValue.TIMESTAMP
                    }).then(() => {
                        userStatusRef.set({
                            online: true,
                            lastChanged: firebase.database.ServerValue.TIMESTAMP
                        });
                    });
                });
                
                // Si estamos en página de mantenimiento y el usuario no es del equipo
                if (window.location.pathname.includes('mantenimiento') && !uidsTeam.includes(user.uid)) {
                    setTimeout(() => {
                        window.location.href = "https://grouvex.github.io";
                    }, 3000);
                }
            } else {
                // Usuario no autenticado
                document.getElementById('auth-container').style.display = 'block';
                document.getElementById('content').style.display = 'none';
                
                // Si estamos en una página protegida, redirigir a login
                const paginasProtegidas = ["grouvex-studios-recording", "grouvex-studios-animation", "team"];
                const paginaActual = window.location.pathname.split('/').pop().replace('.html', '');
                
                if (paginasProtegidas.includes(paginaActual)) {
                    window.location.href = "https://grouvex.github.io/login";
                }
            }
        });

        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            inicializarFormularioDeAutenticacion();
            setupUIButtons();
        });
    </script>
</body>
</html>
